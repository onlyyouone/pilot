
#### TESTS - List of different types of tests

set(TEST_MODULES
    obj
    )

set(SAMPLE_EXES
    )

if(PACKAGE)
  set(NO_TEST On)
endif(PACKAGE)

#### TEST Setup
if(NOT NO_TEST)
  foreach(module ${TEST_MODULES})
    set(test_name ${module}_test)
    set(${module}_SRC test/${module}/${test_name}.c)
    add_executable(${test_name} ${${module}_SRC})
    target_include_directories(${test_name} PUBLIC src/${module} test)
    target_link_libraries(${test_name} proj)
  endforeach(module)

  foreach(module ${SAMPLE_EXES})
    set(${module}_SRC test/sample/${module}.c)
    add_executable(${module} ${${module}_SRC})
    target_include_directories(proj PUBLIC src)
    target_include_directories(${module} PUBLIC sample)
    message(${OPENSSL_LIBRARIES})
    target_link_libraries(${module} proj)
  endforeach(module)
endif(NOT NO_TEST)

if (NOT PACKAGE)
  # testing via `make test` or `ctest`
  enable_testing()

  foreach(module ${SAMPLE_EXES})
    add_test(test_${module} ./${module})
  endforeach(module)

  foreach(module ${TEST_MODULES})
    if (GCOV_BUILD)
      add_test(test_${module}_mem ./${module} -memtest_cov 1000)
    elseif (MEMFAIL_BUILD)
      add_test(test_${module}_mem ./${module} -memtest_fail 50)
    else()
      add_test(test_${module} ./${module})
    endif()
  endforeach(module)

endif(NOT PACKAGE)
